{% extends "base.html" %}

{% block title %}AI & LLM Settings - HuduGlue{% endblock %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'core:dashboard' %}">Dashboard</a></li>
        <li class="breadcrumb-item active">AI & LLM Settings</li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cog"></i> Settings</h5>
            </div>
            <div class="list-group list-group-flush">
                <a href="{% url 'core:settings_general' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-sliders-h"></i> General
                </a>
                <a href="{% url 'core:settings_security' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-shield-alt"></i> Security
                </a>
                <a href="{% url 'core:settings_smtp' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-envelope"></i> SMTP/Email
                </a>
                <a href="{% url 'core:settings_scheduler' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-clock"></i> Task Scheduler
                </a>
                <a href="{% url 'core:settings_directory' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-users-cog"></i> Directory Services
                </a>
                <a href="{% url 'core:settings_ai' %}" class="list-group-item list-group-item-action active">
                    <i class="fas fa-robot"></i> AI & LLM
                </a>
                <a href="{% url 'core:system_status' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-heartbeat"></i> System Status
                </a>
                <a href="{% url 'core:maintenance' %}" class="list-group-item list-group-item-action">
                    <i class="fas fa-tools"></i> Maintenance
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-robot"></i> AI & LLM Settings</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>About AI Floor Plan Generation:</strong> HuduGlue uses Claude AI to intelligently design office floor plans based on building dimensions, employee count, departments, and network requirements. The AI analyzes your specifications and generates professional Draw.io diagrams with proper room layouts, network infrastructure, and security systems.
                </div>

                <form method="post">
                    {% csrf_token %}

                    <h5 class="mb-3">Anthropic (Claude AI)</h5>

                    <div class="mb-3">
                        <label for="anthropic_api_key" class="form-label">Anthropic API Key</label>
                        <input type="password" class="form-control font-monospace" id="anthropic_api_key" name="anthropic_api_key" value="{{ current_anthropic_key }}" placeholder="sk-ant-api03-...">
                        <div class="form-text">
                            Required for AI floor plan generation. Get your API key at <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="claude_model" class="form-label">Claude Model</label>
                        <select class="form-select" id="claude_model" name="claude_model">
                            <option value="claude-opus-4-5-20251101" {% if current_claude_model == 'claude-opus-4-5-20251101' %}selected{% endif %}>Claude Opus 4.5 (Most Capable)</option>
                            <option value="claude-sonnet-4-5-20250929" {% if current_claude_model == 'claude-sonnet-4-5-20250929' %}selected{% endif %}>Claude Sonnet 4.5 (Balanced - Recommended)</option>
                            <option value="claude-3-5-sonnet-20241022" {% if current_claude_model == 'claude-3-5-sonnet-20241022' %}selected{% endif %}>Claude 3.5 Sonnet (Legacy)</option>
                            <option value="claude-3-5-haiku-20241022" {% if current_claude_model == 'claude-3-5-haiku-20241022' %}selected{% endif %}>Claude 3.5 Haiku (Fastest, Lower Cost)</option>
                        </select>
                        <div class="form-text">
                            Choose the Claude model for floor plan generation. Sonnet 4.5 offers the best balance of quality and cost.
                        </div>
                    </div>

                    <hr class="my-4">

                    <h5 class="mb-3">Mapping & Geocoding (Optional)</h5>

                    <div class="mb-3">
                        <label for="google_maps_api_key" class="form-label">Google Maps API Key</label>
                        <input type="password" class="form-control font-monospace" id="google_maps_api_key" name="google_maps_api_key" value="{{ current_google_maps_key }}" placeholder="AIza...">
                        <div class="form-text">
                            Optional. Used for geocoding addresses and fetching satellite imagery. Get your API key at <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Important:</strong> After saving changes, you must restart the application for the new API keys to take effect.
                        <br><code>sudo systemctl restart huduglue-gunicorn</code>
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">
                            Changes are saved to .env file
                        </small>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </form>

                <hr class="my-4">

                <h5 class="mb-3">Usage Information</h5>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Required API</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AI Floor Plan Generation</td>
                                <td>Anthropic Claude</td>
                                <td>
                                    {% if current_anthropic_key %}
                                    <span class="badge bg-success">Configured</span>
                                    {% else %}
                                    <span class="badge bg-warning">Not Configured</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td>Address Geocoding</td>
                                <td>Google Maps</td>
                                <td>
                                    {% if current_google_maps_key %}
                                    <span class="badge bg-success">Configured</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Optional</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td>Satellite Imagery</td>
                                <td>Google Maps</td>
                                <td>
                                    {% if current_google_maps_key %}
                                    <span class="badge bg-success">Configured</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Optional</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card bg-light mt-3">
                    <div class="card-body">
                        <h6 class="card-title"><i class="fas fa-lightbulb"></i> Cost Estimates</h6>
                        <p class="card-text small mb-2">
                            <strong>Claude Sonnet 4.5:</strong> ~$0.03-0.10 per floor plan<br>
                            <strong>Claude Opus 4.5:</strong> ~$0.15-0.30 per floor plan<br>
                            <strong>Claude Haiku 3.5:</strong> ~$0.01-0.03 per floor plan
                        </p>
                        <p class="card-text small text-muted mb-0">
                            Actual costs depend on building complexity and requirements. Most office floor plans use 500-2000 tokens.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
