{% extends "base.html" %}

{% block title %}{{ action }} Diagram Template - HuduGlue{% endblock %}

{% block content %}
<div class="mb-4">
    <h1><i class="fas fa-th-large"></i> {{ action }} Diagram Template</h1>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'docs:diagram_list' %}">Diagrams</a></li>
            <li class="breadcrumb-item"><a href="{% url 'docs:diagram_template_list' %}">Templates</a></li>
            <li class="breadcrumb-item active">{{ action }}</li>
        </ol>
    </nav>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                {% if action == 'Create' %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>Creating a Template:</strong> After filling out this form, you'll be redirected to the diagram editor to design your template.
                </div>
                {% endif %}

                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">
                            Title <span class="text-danger">*</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                        <div class="text-danger small">{{ form.title.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">Descriptive name for this template</small>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.slug.id_for_label }}" class="form-label">
                            Slug <span class="text-danger">*</span>
                        </label>
                        {{ form.slug }}
                        {% if form.slug.errors %}
                        <div class="text-danger small">{{ form.slug.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">URL-friendly identifier (auto-generated if left blank)</small>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                        <div class="text-danger small">{{ form.description.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">Brief description of this template</small>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.diagram_type.id_for_label }}" class="form-label">
                            Diagram Type <span class="text-danger">*</span>
                        </label>
                        {{ form.diagram_type }}
                        {% if form.diagram_type.errors %}
                        <div class="text-danger small">{{ form.diagram_type.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">Category of diagram</small>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.tags.id_for_label }}" class="form-label">Tags</label>
                        {{ form.tags }}
                        {% if form.tags.errors %}
                        <div class="text-danger small">{{ form.tags.errors }}</div>
                        {% endif %}
                        <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple tags</small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            {{ form.is_published }}
                            <label class="form-check-label" for="{{ form.is_published.id_for_label }}">
                                Published
                            </label>
                        </div>
                        <small class="form-text text-muted">Make this template visible to organization members</small>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            {{ form.is_template }}
                            <label class="form-check-label" for="{{ form.is_template.id_for_label }}">
                                Is Template
                            </label>
                        </div>
                        <small class="form-text text-muted">This is automatically set for templates</small>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <a href="{% url 'docs:diagram_template_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-question-circle"></i> What are Templates?</h6>
            </div>
            <div class="card-body">
                <p class="small">
                    Diagram templates are reusable designs that can be cloned to create new diagrams quickly. They're useful for:
                </p>
                <ul class="small">
                    <li>Standard network layouts</li>
                    <li>Common architecture patterns</li>
                    <li>Process flowchart templates</li>
                    <li>Rack diagram layouts</li>
                </ul>
                <p class="small mb-0">
                    Templates are shared across your organization and can be used by all members.
                </p>
            </div>
        </div>

        {% if action == 'Edit' and template %}
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Template Info</h6>
            </div>
            <div class="card-body">
                <dl class="small mb-0">
                    <dt>Created:</dt>
                    <dd>{{ template.created_at|date:"F j, Y g:i A" }}</dd>

                    {% if template.created_by %}
                    <dt>Created By:</dt>
                    <dd>{{ template.created_by.username }}</dd>
                    {% endif %}

                    <dt>Version:</dt>
                    <dd>{{ template.version }}</dd>

                    <dt>Last Modified:</dt>
                    <dd>{{ template.last_edited_at|date:"F j, Y g:i A" }}</dd>
                </dl>

                <div class="mt-3">
                    <a href="{% url 'docs:diagram_edit' template.slug %}" class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-edit"></i> Edit Diagram Content
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Auto-generate slug from title
document.getElementById('id_title').addEventListener('blur', function() {
    const title = this.value;
    const slugField = document.getElementById('id_slug');

    if (title && !slugField.value) {
        const slug = title.toLowerCase()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/--+/g, '-')
            .trim();
        slugField.value = slug;
    }
});
</script>
{% endblock %}
